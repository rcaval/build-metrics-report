(function(){"use strict";angular.module("buildMetricsReportApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.grid"]).config(["$routeProvider","$httpProvider",function(a,b){return a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/pivot",{templateUrl:"views/pivot.html",controller:"PivotCtrl",controllerAs:"pivot"}).when("/originaldata",{templateUrl:"views/originaldata.html",controller:"OriginalDataCtrl",controllerAs:"originaldata"}).otherwise({redirectTo:"/"}),b.defaults.headers.common["Access-Control-Allow-Origin"]="*"}]).run(["$rootScope","$location",function(a,b){return a.QueryParams=b.search()}])}).call(this),function(){"use strict";angular.module("buildMetricsReportApp").controller("MainCtrl",["$scope","$http","jenkinsDataService",function(a,b,c){var d,e,f,g,h;e=$.pivotUtilities.aggregatorTemplates,d=$.pivotUtilities.aggregators,f=$.pivotUtilities.derivers.dateFormat,g=$.pivotUtilities.numberFormat,a.data=c.data,a.weeklyBuildTime={options:{renderer:$.pivotUtilities.c3_renderers["Area Chart"],rows:["segment"],cols:["week"],aggregatorName:"Duration",aggregator:e.average(f("%M:%s"))(["duration"]),rendererOptions:{c3:{size:{height:350,width:700},axis:{y:{tick:{values:d3.range(0,18e5,12e4),format:function(a){return d3.time.format("%Mm %Ss")(new Date(a))}}},x:{label:""}},grid:{y:{show:!0}},data:{type:"area-step"},tooltip:{grouped:!0}}}}},a.weeklySucessRate={defaultOptions:{renderer:$.pivotUtilities.c3_renderers["Stacked Bar Chart"],rows:["segment","result"],cols:["day"],aggregator:d["Count as Fraction of Columns"](),filter:function(a){return"1-compile"===a.segment},sorters:function(a){return"result"===a?$.pivotUtilities.sortAs(["SUCCESS","FAILURE","ABORTED"]):void 0},rendererOptions:{c3:{size:{height:150,width:300},axis:{y:{tick:{format:g({digitsAfterDecimal:1,scaler:100,suffix:"%"})},padding:{top:0}},x:{show:!1,label:"",padding:{left:0}}},grid:{y:{show:!0}},data:{type:"bar",order:"asc"},bar:{width:{ratio:1}},tooltip:{grouped:!0},legend:{show:!1},color:{pattern:["#109618","#dc3912","#333","#ff9900"]}}}}},h=function(b){return _.assign({},a.weeklySucessRate.defaultOptions,{filter:function(a){return a.segment===b}})},a.weeklySucessRate.compile=h("1-compile"),a.weeklySucessRate.functional=h("2-functional-tests"),a.weeklySucessRate.qaDeploy=h("3-qa-deploy"),a.weekly7DaysMTTR={options:{renderer:$.pivotUtilities.c3_renderers["Line Chart"],cols:["week"],rows:["segment"],aggregator:d.Maximum(["7 Days MTTR"]),rendererOptions:{c3:{size:{height:350,width:700},axis:{y:{tick:{values:d3.range(0,216e5,18e5),format:function(a){return d3.time.format("%X")(new Date(2012,0,0,0,0,0,a))}},padding:{bottom:0}},x:{padding:{left:0}}},tooltip:{grouped:!0},grid:{y:{show:!0}}}}}},a.weekly7DaysMTTF={options:{renderer:$.pivotUtilities.c3_renderers["Line Chart"],cols:["week"],rows:["segment"],aggregator:d.Maximum(["7 Days MTTF"]),rendererOptions:{c3:{size:{height:350,width:700},axis:{y:{label:"Hours",tick:{format:function(a){return Math.floor(a/36e5)}},padding:{bottom:0}},x:{padding:{left:0}}},tooltip:{grouped:!0},grid:{y:{show:!0}}}}}}}])}.call(this),function(){"use strict";var a,b;b=angular.module("buildMetricsReportApp"),a=function(){function a(a,b){this.data=b.data}return a.$inject=["$scope","jenkinsDataService"],a}(),b.controller("PivotCtrl",a)}.call(this),function(){"use strict";angular.module("buildMetricsReportApp").directive("pivotTable",function(){return{scope:{datasource:"=",options:"=",pivotUi:"=",showConfig:"="},link:function(a,b,c){return a.datasource.then(function(c){var d,e;return e=$.extend($.pivotUtilities.renderers,$.pivotUtilities.c3_renderers),d=a.options,d=_.merge({},d,{renderers:e}),a.showConfig&&(d.onRefresh=function(a){var b;return b=JSON.parse(JSON.stringify(a)),delete b.aggregators,delete b.renderers,delete b.derivedAttributes,delete b.rendererOptions,delete b.localeStrings,console.log(JSON.stringify(b,void 0,2))}),a.pivotUi?$(b).pivotUI(c,d):$(b).pivot(c,d)})}}})}.call(this),function(){"use strict";var a,b;b=angular.module("buildMetricsReportApp"),a=function(){function a(a,c,d,e){var f,g,h,i,j;f=c.defer(),g=["1-compile","2-functional-tests","3-qa-deploy"],j="data/:jobName.json",i=d.search(),i.host&&i.jobNames&&(g=_(i.jobNames.split(",")).map(_.trim).value(),j=""+i.host+"/job/:jobName/api/json?tree=allBuilds[number,id,timestamp,result,duration]",console.log(j)),h=_(g).map(function(c,d){return a(j,{jobName:c},{query:{isArray:!0,transformResponse:function(a,b){var c;return c=angular.fromJson(a),c.builds}}}).query(function(a){var f;return f=_(a).each(function(a,b){return a.segment=c,a.order=d}).each(b).value(),e.calculateAllTimeMTTR(f),e.calculateAllTimeMTTF(f),e.calculate7DaysMTTR(f),e.calculate7DaysMTTF(f),f}).$promise}).value(),c.all(h).then(function(a){return f.resolve(_.flatten(a))}),this.data=f.promise}var b;return a.$inject=["$resource","$q","$location","mttrService"],b=function(a){return a.date=new Date(a.timestamp),a.month=d3.time.format("%Y-%m")(a.date),a.week=d3.time.format("%Y-%U")(a.date),a.day=d3.time.format("%Y-%m-%d")(a.date),a},a}(),b.service("jenkinsDataService",a)}.call(this),function(){"use strict";angular.module("buildMetricsReportApp").controller("OriginalDataCtrl",["$scope","jenkinsDataService",function(a,b){b.data.then(function(b){return a.data=b})}])}.call(this),function(){"use strict";angular.module("buildMetricsReportApp").service("mttrService",function(){var a,b;return b=function(a,b,c){var d,e,f;return d=0,e=0,f=0,_(a).sortBy("timestamp").each(function(a){if(a[b]=0,a.result!==c){if(0!==d)return;return void(d=a.timestamp)}return 0!==d?(e++,f+=a.timestamp-d,a[b]=0===f?0:f/e,d=0):void 0}).value()},a=function(a,c,d,e){return _(a).sortBy("timestamp").reverse().each(function(f){var g,h;return h=new Date(f.timestamp),h.setDate(h.getDate()-c),g=_.filter(a,function(a){var b;return h.getTime()<=(b=a.timestamp)&&b<=f.timestamp}),b(g,d,e)}).value()},{calculate7DaysMTTR:function(b){return a(b,7,"7 Days MTTR","SUCCESS")},calculate7DaysMTTF:function(b){return a(b,7,"7 Days MTTF","FAILURE")},calculateAllTimeMTTR:function(a){return b(a,"allTimeMTTR","SUCCESS")},calculateAllTimeMTTF:function(a){return b(a,"allTimeMTTF","FAILURE")}}})}.call(this),function(){"use strict";angular.module("buildMetricsReportApp").controller("RefreshCtrl",["$scope","$location",function(a,b){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.go=function(){return b.search(a.QueryParams)}}])}.call(this),function(){"use strict";angular.module("buildMetricsReportApp").filter("queryParams",function(){return function(a){var b,c;c=[];for(b in a)b=b,a.hasOwnProperty(b)&&""!==a[b]&&void 0!==a[b]&&c.push(b+"="+a[b]);return c.length?"?"+c.join("&"):""}})}.call(this),angular.module("buildMetricsReportApp").run(["$templateCache",function(a){"use strict";a.put("views/main.html",'<div class="row"> <div class="panel panel-default"> <div class="panel-heading">Mean Time To Recover (MTTR), last 7 days, Weekly Trend </div> <div class="panel-body chart" pivot-table datasource="data" options="weekly7DaysMTTR.options" pivot-ui="false"></div> </div> <div class="panel panel-default"> <div class="panel-heading">Mean Time To Failure (MTTF), last 7 days, Weekly Trend </div> <div class="panel-body chart" pivot-table datasource="data" options="weekly7DaysMTTF.options" pivot-ui="false"></div> </div> <div class="panel panel-default"> <div class="panel-heading">Build Time</div> <div class="panel-body chart" pivot-table datasource="data" options="weeklyBuildTime.options" pivot-ui="false"></div> </div> <div class="panel panel-default"> <div class="panel-heading">Build Success Rate </div> <div class="panel-body"> <div class="col-md-6"> <div class="panel panel-default"> <div class="panel-heading">Component</div> <div class="panel-body chart" pivot-table datasource="data" options="weeklySucessRate.compile" pivot-ui="false"></div> </div> <div class="panel panel-default"> <div class="panel-heading">QA Deploy</div> <div class="panel-body chart" pivot-table datasource="data" options="weeklySucessRate.qaDeploy" pivot-ui="false"></div> </div> </div> <div class="col-md-6"> <div class="panel panel-default"> <div class="panel-heading">Functional</div> <div class="panel-body chart" pivot-table datasource="data" options="weeklySucessRate.functional" pivot-ui="false"></div> </div> </div> </div> </div> </div>'),a.put("views/originaldata.html",'<div ui-grid="{data: data}" class="grid"> </div>'),a.put("views/pivot.html",'<section ng-controller="PivotCtrl as ctrl"> <div datasource="ctrl.data" pivot-table="{rows: [], cols: [], vals: [], rendererName: \'Table\'}" pivot-ui="true" show-config="true"></div> </section>')}]);